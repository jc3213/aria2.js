<script>
function aria2JsonrpcEcho() {
    return new Promise((resolve, reject) => {
        let connect = (event) => {
            let { aria2c, name, version } = event.data;
            if (aria2c === 'aria2c_jsonrpc_reply') {
                clearTimeout(timer);
                window.removeEventListener('message', connect);
                resolve({ name, version });
            }
        };
        let timer = setTimeout(() => {
            window.removeEventListener('message', connect);
            reject(new Error('"Download With Aria2" has not been installed!'));
        }, 10000);
        window.addEventListener('message', connect);
        window.postMessage({ aria2c: 'aria2c_jsonrpc_echo' });
    });
}

aria2JsonrpcEcho()
    .then(( { name, version } ) => {
        alert('"' + name + '" v' + version + ' has been installed successfully.');
        close();
    })
    .catch((err) => {
        alert('"Download with Aria2" has not been installed!");
        close();
    });
</script>
